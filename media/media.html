<!DOCTYPE html>
<html lang="zh-CN" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOYU | NEURAL LIBRARY</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2245%22 fill=%22%23050505%22 stroke=%22white%22 stroke-width=%222%22/><circle cx=%2250%22 cy=%2250%22 r=%2215%22 fill=%22%2300f3ff%22 filter=%22blur(2px)%22/></svg>">
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Rajdhani:wght@500;700&family=Space+Grotesk:wght@300;500&family=Inter:wght@300;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { bg: '#050505', dim: '#888888', 'accent-blue': '#00f3ff', 'accent-red': '#ff2a2a' },
                    fontFamily: { serif: ['"Cinzel"', 'serif'], mono: ['"Space Grotesk"', 'monospace'], sans: ['"Inter"', 'sans-serif'] },
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #020202;
            color: #EAEAEA;
        }

        ::-webkit-scrollbar {
            width: 0;
        }

        /* 修复 1：确保有 Canvas 容器和噪音背景层 */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            pointer-events: none;
        }

        #noise-layer {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='1'/%3E%3C/svg%3E");
        }

        /* 样式 */
        .mega-title {
            font-family: 'Cinzel', serif;
            font-size: 10vw;
            line-height: 0.8;
            color: transparent;
            -webkit-text-stroke: 1px rgba(255, 255, 255, 0.8);
            opacity: 0.5;
        }

        .book-card {
            display: flex;
            gap: 20px;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 0;
            transition: all 0.3s;
            cursor: pointer;
        }

        .book-card:hover {
            padding-left: 20px;
            border-color: #fff;
        }

        .book-cover {
            width: 80px;
            height: 110px;
            background: #111;
            border: 1px solid #333;
            transition: all 0.3s;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Cinzel';
            font-size: 2rem;
            color: #333;
        }

        .book-card:hover .book-cover {
            border-color: #fff;
            color: #fff;
        }
    </style>
</head>

<body>
    <div id="noise-layer"></div>
    <div id="canvas-container"></div>

    <nav class="fixed top-0 w-full p-8 z-50 flex justify-between items-center mix-blend-difference">
        <a href="../index.html"
            class="font-mono text-xs tracking-widest hover:text-white text-gray-400 transition-colors">
            <i class="ri-arrow-left-line"></i> RETURN TO BASE
        </a>
        <div class="font-serif text-xl tracking-widest text-white hidden md:block">NEURAL LIBRARY</div>
        <div class="w-10"></div>
        <div class="relative group font-mono pointer-events-auto" id="audio-console">
            <div class="relative">
                <button id="music-trigger"
                    class="flex items-center gap-3 opacity-80 hover:opacity-100 transition-opacity cursor-pointer"
                    onclick="toggleMainPlayback()">
                    <div class="flex items-end gap-[2px] h-3" id="master-wave">
                        <div class="wave-bar w-[2px] h-1 bg-white"></div>
                        <div class="wave-bar w-[2px] h-2 bg-white"></div>
                        <div class="wave-bar w-[2px] h-1.5 bg-white"></div>
                        <div class="wave-bar w-[2px] h-3 bg-white"></div>
                    </div>
                    <div class="flex flex-col leading-none text-left">
                        <span class="text-[10px] tracking-widest text-white truncate max-w-[120px]"
                            id="current-track-name">AUDIO OFF</span>
                        <span id="time-display" class="text-[8px] text-dim mt-1 hidden">0:00 / 0:00</span>
                    </div>
                </button>
                <div id="progress-container"
                    class="absolute bottom-[-5px] left-0 w-full h-[2px] bg-white/20 cursor-pointer hidden hover:h-[4px] transition-all z-50">
                    <div id="progress-bar" class="h-full bg-accent-blue w-0 relative">
                        <div
                            class="absolute right-0 top-1/2 -translate-y-1/2 w-2 h-2 bg-white rounded-full shadow-[0_0_10px_#00f3ff] opacity-0 group-hover:opacity-100">
                        </div>
                    </div>
                </div>
            </div>
            <div
                class="absolute top-full left-0 w-64 pt-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2 pointer-events-none group-hover:pointer-events-auto">
                <div class="bg-black/95 backdrop-blur-xl border border-white/20 p-2 flex flex-col gap-1 shadow-2xl">
                    <div class="absolute top-0 left-0 w-2 h-2 border-t border-l border-accent-blue"></div>
                    <div class="absolute bottom-0 right-0 w-2 h-2 border-b border-r border-accent-blue"></div>
                    <div id="playlist-container"></div>
                </div>
            </div>
        </div>
        <audio id="global-audio"></audio>
    </nav>

    <main class="max-w-[1200px] mx-auto px-8 pt-32 pb-20 relative z-10">
        <div class="mb-24 grid md:grid-cols-2 gap-12 items-end">
            <div>
                <div class="inline-flex items-center gap-2 px-3 py-1 border border-white/30 rounded-full mb-8"><span
                        class="w-1.5 h-1.5 bg-white rounded-full animate-pulse"></span><span
                        class="font-mono text-[10px] tracking-widest">INPUT SOURCE</span></div>
                <h1 class="mega-title">NEURAL<br>LIBRARY</h1>
            </div>
            <div class="font-sans text-gray-400 text-lg max-w-md leading-relaxed">Input source for the mind. Books,
                Frequencies, and Cinema.</div>
        </div>

        <section class="mb-32">
            <div class="flex items-center gap-4 mb-12 border-b border-white/10 pb-4"><i
                    class="ri-book-3-line text-accent-red"></i><span
                    class="font-mono text-xs tracking-[0.2em] text-gray-500">DATA ARCHIVE // BOOKS</span></div>
            <div class="grid md:grid-cols-2 gap-12">
                <div class="book-card group">
                    <div class="book-cover group-hover:border-accent-red group-hover:text-accent-red">I</div>
                    <div>
                        <h3 class="font-serif text-2xl text-white group-hover:text-accent-red transition-colors">
                            Thinking, Fast and Slow</h3>
                        <p class="font-mono text-xs text-gray-500 mt-1">Daniel Kahneman</p>
                    </div>
                </div>
                <div class="book-card group">
                    <div class="book-cover group-hover:border-accent-red group-hover:text-accent-red">II</div>
                    <div>
                        <h3 class="font-serif text-2xl text-white group-hover:text-accent-red transition-colors">The
                            Black Swan</h3>
                        <p class="font-mono text-xs text-gray-500 mt-1">Nassim Nicholas Taleb</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // 平滑滚动
        const lenis = new Lenis({ duration: 1.2, smooth: true });
        function raf(time) { lenis.raf(time); requestAnimationFrame(raf); } requestAnimationFrame(raf);

        // 修复 2：GSAP 入场动画优化 (使用 clearProps 确保动画结束后清理样式)
        gsap.from("h1.mega-title, .font-sans.text-lg", { y: 50, opacity: 0, duration: 1.2, stagger: 0.2, ease: "power3.out" });

        // 重点修复：书籍列表动画。移除之前的固定 delay，使用 ScrollTrigger 或确保它在页面加载后立即执行。
        // 这里使用简单的立即执行方案，并确保最终状态正确。
        gsap.set(".book-card", { opacity: 0, y: 30 }); // 初始状态设置
        ScrollTrigger.batch(".book-card", {
            onEnter: batch => gsap.to(batch, { opacity: 1, y: 0, duration: 0.8, stagger: 0.15, ease: "power2.out" }),
            start: "top 90%" // 当元素进入视口 90% 时触发
        });

        // 修复 1：Three.js 粒子星海背景 (确保在 DOM 加载后执行)
        document.addEventListener("DOMContentLoaded", function () {
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0015); // 增加一点雾气感
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.z = 100;
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // 优化性能
            // 确保容器存在
            const container = document.getElementById('canvas-container');
            if (container) container.appendChild(renderer.domElement);

            const geometry = new THREE.BufferGeometry();
            const count = 2000; // 粒子数量
            const positions = new Float32Array(count * 3);
            for (let i = 0; i < count * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 1200;
                positions[i + 1] = (Math.random() - 0.5) * 1200;
                positions[i + 2] = (Math.random() - 0.5) * 1200;
            }
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const material = new THREE.PointsMaterial({ size: 1, color: 0x888888, transparent: true, opacity: 0.5, sizeAttenuation: true });
            const starField = new THREE.Points(geometry, material);
            scene.add(starField);

            let mouseX = 0, mouseY = 0;
            window.addEventListener('mousemove', e => { mouseX = (e.clientX - window.innerWidth / 2) * 0.05; mouseY = (e.clientY - window.innerHeight / 2) * 0.05; });

            function animate() {
                starField.rotation.y += 0.0003; // 缓慢旋转
                camera.position.x += (mouseX - camera.position.x) * 0.05;
                camera.position.y += (-mouseY - camera.position.y) * 0.05;
                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            }
            animate();
            window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        });
    </script>
    <script src="../js/audio.js"></script>
</body>

</html>